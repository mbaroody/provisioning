---
- ansible.builtin.uri:
    url: https://api.github.com/repos/ankitects/anki/releases/latest
    headers:
      Accept: application/vnd.github.v3+json
    return_content: true
  register: uri_res

- debug: var=uri_res.json.tag_name verbosity=2
- debug: var=ansible_dependent_role_names verbosity=2

- ansible.builtin.uri:
    url: "https://github.com/ankitects/anki/releases/download/{{ uri_res.json.tag_name }}/anki-{{ uri_res.json.tag_name }}-linux-qt6.tar.zst"
    headers:
      Accept: application/vnd.github.v3+json
    dest: "/tmp/anki-{{ uri_res.json.tag_name }}-linux-qt6.tar.zst"
    status_code: [200, 304]

- ansible.builtin.unarchive:
    src: "/tmp/anki-{{ uri_res.json.tag_name }}-linux-qt6.tar.zst"
    dest: /opt
  become: true

- ansible.builtin.command: "/opt/anki-{{ uri_res.json.tag_name }}-linux-qt6/install.sh"
  args:
    chdir: "/opt/anki-{{ uri_res.json.tag_name }}-linux-qt6"
    creates: /usr/local/share/anki/anki
  become: true

# sync addons
- ansible.posix.synchronize:
    src: files/
    dest: "{{ ansible_env.HOME}}/.local/share/Anki2"
    owner: yes
    group: yes